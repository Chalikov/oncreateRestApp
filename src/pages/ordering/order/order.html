<style>
.thetxtarea, .thetxtarea textarea {
  height:100px;
}

.numbering {
  font-size: 1.4em;
}
</style>

<ion-header>
  <ion-navbar>
    <button ion-button menuToggle>
      <ion-icon name="menu"></ion-icon>
    </button>
    <ion-title>{{ 'order.title' | translate }}</ion-title>
  </ion-navbar>
</ion-header>
<ion-content padding>

  <ion-segment [(ngModel)]="delivery_option">
    <ion-segment-button (click)="toggleDelivery('delivery')" value="delivery">
      <ion-label style="margin: 0;">Delivery</ion-label>
    </ion-segment-button>
    <ion-segment-button (click)="toggleDelivery('collection')" value="collection">
      <ion-label style="margin: 0;">Collection</ion-label>
    </ion-segment-button>
  </ion-segment>

  <form *ngIf="formReady" [formGroup]="orderForm" (ngSubmit)="placeOrder(orderForm.value)" novalidate>
    <ion-item>
      <ion-label [class.input-error-regular]="orderForm.controls['name'].invalid" fixed>{{ 'order.name' | translate }}</ion-label>
      <ion-input maxlength="25" placeholder="{{ 'order.click_to_write' | translate }}" type="text" style="color:gray"
                 [formControl]="orderForm.controls.name"></ion-input>
    </ion-item>
    <ion-item>
      <ion-label [class.input-error-regular]="orderForm.controls['phone'].invalid" fixed>{{ 'order.phone' | translate }}</ion-label>
      <ion-input [brmasker]="{mask:'+0', type: 'num', len: 13}"
                 placeholder="{{ 'order.click_to_write' | translate }}" type="tel" style="color:gray"
                 [formControl]="orderForm.controls.phone"></ion-input>
    </ion-item>
    <div [ngSwitch]="delivery_option">
      <button *ngSwitchCase="'delivery'" type="button" ion-item detail-none (click)="showAddressWindow()">
        <ion-label [class.input-error-regular]="orderForm.controls['address'].invalid" fixed>{{ 'order.address' | translate }}</ion-label>
        <ion-textarea [(ngModel)]="address_input" placeholder="{{ 'order.click_to_write' | translate }}" type="text"
                   [formControl]="orderForm.controls.address"></ion-textarea>
      </button>
    </div>
    <ion-item>
      <ion-label fixed>{{ 'order.promo_code' | translate }}</ion-label>
      <ion-input placeholder="{{ 'order.optional' | translate }}" type="text"
                 [formControl]="orderForm.controls.promo_code"></ion-input>
      <button ion-button item-right type="button" (click)="validatePromo()">{{ 'order.check_promo' | translate }}
      </button>
    </ion-item>
    <ion-item>
      <ion-label fixed>{{ 'order.comment' | translate }}</ion-label>
      <ion-textarea [formControl]="orderForm.controls.comment"
                    placeholder="{{ 'order.optional' | translate }}"></ion-textarea>
    </ion-item>
    <ion-list radio-group [formControl]="orderForm.controls.payment_method">
      <ion-item>
        <ion-label>Cash</ion-label>
        <ion-radio name="payment_method" value="cash" (click)="toggleStripeForm('')"></ion-radio>
      </ion-item>
      <ion-item>
        <ion-label>Card</ion-label>
        <ion-radio id="stripe" name="payment_method" value="stripe" (click)="toggleStripeForm('stripe')"></ion-radio>
      </ion-item>

      <div *ngIf="stripePushed" style="padding-bottom: 30px; margin-left: 30px; margin-right: 30px;">
        <br>
        <form [formGroup]="cardForm" novalidate>
          <ion-item>
            <ion-label [class.input-error]="cardForm.controls['number'].invalid" stacked>{{ 'credit_card.number' | translate }}</ion-label>
            <ion-input type="tel" [brmasker]="{mask:'0000-0000-0000-0000', len:19}" maxlength="19" [formControl]="cardForm.controls.number"></ion-input>
          </ion-item>
          <ion-row>
            <ion-col>
              <ion-item>
                <ion-label [class.input-error]="cardForm.controls['expMonth'].invalid" stacked>Exp MM</ion-label>
                <ion-input type="text" pattern="[0-9]*"  maxlength="2" [formControl]="cardForm.controls.expMonth"></ion-input>
              </ion-item>
            </ion-col>
            <ion-col>
              <ion-item>
                <ion-label [class.input-error]="cardForm.controls['expYear'].invalid" stacked>Exp YY</ion-label>
                <ion-input type="text" pattern="[0-9]*" maxlength="2" [formControl]="cardForm.controls.expYear"></ion-input>
              </ion-item>
            </ion-col>
          </ion-row>
          <ion-item>
            <ion-label [class.input-error]="cardForm.controls['cvc'].invalid" stacked>{{ 'credit_card.cvc' | translate }}</ion-label>
            <ion-input type="text" pattern="[0-9]*" maxlength="4" [formControl]="cardForm.controls.cvc"></ion-input>
          </ion-item>
          <!--<button type="submit" ion-button block primary>{{ 'credit_card.pay' | translate }}</button>-->
          <!--<button (click)="closeModal()" type="button" ion-button block>{{ 'credit_card.cancel' | translate }}</button>-->
        </form>
      </div>
      <ion-item>
        <ion-label>{{ 'order.paypal' | translate }}</ion-label>
        <ion-radio name="payment_method" value="paypal" (click)="toggleStripeForm('')"></ion-radio>
      </ion-item>
    </ion-list>
    <!--<ion-list *ngIf="userData.loyalty_reward > 0">-->
      <!--<ion-item>-->
        <!--<ion-label stacked>{{ 'order.use_reward' | translate:{amount: userData.loyalty_reward | ecurrency} }}</ion-label>-->
        <!--<ion-input [formControl]="orderForm.controls.loyalty" type="number" max="userData.loyalty_reward"></ion-input>-->
        <!--<button ion-button item-right type="button" (click)="useReward()">{{ 'order.use' | translate }}</button>-->
      <!--</ion-item>-->
    <!--</ion-list>-->
    <div class="cart-total -nob" style="text-align: center;">
      <ion-row>
        <ion-col col-6>
          <span>{{ 'order.price' | translate }}</span><br /><span class="numbering"> {{ cTotalPrice | ecurrency }}</span>
        </ion-col>
        <ion-col col-6>
          <span>{{ 'order.delivery_price' | translate }}</span><br /><span class="numbering"> {{ deliveryPrice | ecurrency }}</span>
        </ion-col>
        <!-- <ion-col col-6>
            <span>{{ 'order.total' | translate }}</span><br /><span class="numbering"> {{ +cTotalPrice + +deliveryPrice | ecurrency }}</span>
        </ion-col> -->
        <ion-col col-6>
            <div *ngIf="cLoyaltyUsed > 0">{{ 'order.loyalty_used' | translate:{amount: cLoyaltyUsed | ecurrency} }}</div>
            <div *ngIf="discountPrice">{{ 'order.coupon_discount' | translate }}<br /><span class="numbering"> {{ +cFullPrice - +discountPrice | ecurrency}}</span></div>
        </ion-col>
        <!-- <ion-col col-6>
            <div *ngIf="discountPrice > 0 || cLoyaltyUsed > 0">Gross Total<br /><span class="numbering"> {{ +discountPrice - +cLoyaltyUsed + +deliveryPrice | ecurrency }}</span></div>
        </ion-col> -->
        <ion-col col-6>
          <div *ngIf="cTaxPrice > 0">
            <span>{{ 'order.tax' | translate }}</span><br /><span class="numbering"> {{ cTaxPrice | ecurrency }}</span>
          </div>
        </ion-col>
        <div style="width: 100%; border-top: 1px solid #555; margin: 20px auto;"></div>
        <ion-col col-12>
          <div *ngIf="cTaxPrice > 0">
            <span>{{ 'order.total_with_tax' | translate }}</span><br /><span class="numbering"> {{ +cTaxPrice + +discountPrice - +cLoyaltyUsed + +deliveryPrice | ecurrency }}</span>
          </div>
        </ion-col>
      </ion-row>
    </div>
    <br>
    <button type="submit" [disabled]="!orderForm.valid" ion-button block class="place-order-button">{{
      'order.place_order' | translate }}
    </button>
  </form>
</ion-content>
